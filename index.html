<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geospatial Programs & Scholarships Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral & Teal -->
    <!-- Application Structure Plan: The application is designed as a task-oriented dashboard with four main sections: Home, University Explorer, Scholarship Guide, and Admissions Checklist. This structure prioritizes the user's journey of discovering, comparing, and planning. The 'University Explorer' is the core, using interactive filters and a card-based layout to allow users to dynamically query the data, which is more intuitive than a static report. The 'Scholarship Guide' isolates critical funding information, and the 'Admissions Checklist' provides a practical summary. This non-linear, interactive structure empowers users to find information relevant to their specific needs efficiently. -->
    <!-- Visualization & Content Choices: 
        1. University Data -> Goal: Organize/Compare -> Viz: Interactive Card Grid with Filters/Sort -> Interaction: Users can filter by program type and state, and sort by rank or name. Clicking a card reveals detailed information. -> Justification: This is the most effective way to handle a moderately large dataset, allowing users to narrow down choices based on their priorities. -> Method: HTML/CSS/JS.
        2. University Rankings -> Goal: Compare -> Viz: Horizontal Bar Chart -> Interaction: Hover to see details. -> Justification: A bar chart provides a quick, scannable visual comparison of top-ranked institutions, a key decision factor for students. -> Library: Chart.js.
        3. Scholarship Types -> Goal: Inform -> Viz: Donut Chart -> Interaction: Hover to see counts of different funding types. -> Justification: This gives a high-level overview of the funding landscape, showing which types of aid are most common. -> Library: Chart.js.
        4. Admission Requirements -> Goal: Inform -> Viz: Styled Checklist -> Interaction: None. -> Justification: A simple checklist is the clearest and most digestible format for this type of information. -> Method: HTML/CSS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 50vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 500px;
            }
        }
        .nav-link.active {
            color: #0d9488;
            font-weight: 600;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #0d9488;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-amber-50 text-gray-800">

    <header class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold text-teal-700">GeoMasters USA</div>
            <div class="hidden md:flex space-x-8">
                <a href="#home" class="nav-link text-gray-600 hover:text-teal-600 transition-colors">Home</a>
                <a href="#explorer" class="nav-link text-gray-600 hover:text-teal-600 transition-colors">University Explorer</a>
                <a href="#scholarships" class="nav-link text-gray-600 hover:text-teal-600 transition-colors">Scholarship Guide</a>
                <a href="#admissions" class="nav-link text-gray-600 hover:text-teal-600 transition-colors">Admissions</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-gray-600 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden">
            <a href="#home" class="block py-2 px-6 text-sm text-gray-600 hover:bg-teal-50">Home</a>
            <a href="#explorer" class="block py-2 px-6 text-sm text-gray-600 hover:bg-teal-50">University Explorer</a>
            <a href="#scholarships" class="block py-2 px-6 text-sm text-gray-600 hover:bg-teal-50">Scholarship Guide</a>
            <a href="#admissions" class="block py-2 px-6 text-sm text-gray-600 hover:bg-teal-50">Admissions</a>
        </div>
    </header>

    <main>
        <section id="home" class="py-20 bg-white">
            <div class="container mx-auto px-6 text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">Find Your Geospatial Master's Program</h1>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-8">This interactive guide helps you explore U.S. public universities offering Master's degrees in Geomatics, Remote Sensing, and GIS. Compare programs, check rankings, and discover funding opportunities to find your perfect fit.</p>
                <a href="#explorer" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-full hover:bg-teal-700 transition-transform transform hover:scale-105">Start Exploring</a>
            </div>
        </section>

        <section id="explorer" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800">University Explorer</h2>
                    <p class="text-md text-gray-600 max-w-2xl mx-auto mt-2">Use the filters to find universities that match your interests. Click on any university card to see more detailed information about its programs and admission requirements.</p>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-lg mb-10">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 items-end">
                        <div>
                            <label class="font-semibold text-gray-700 block mb-2">Filter by Program</label>
                            <div id="program-filters" class="flex flex-wrap gap-x-4 gap-y-2">
                                <label class="flex items-center space-x-2"><input type="checkbox" value="Geomatics" class="program-filter rounded text-teal-600 focus:ring-teal-500"> <span>Geomatics</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="Remote Sensing" class="program-filter rounded text-teal-600 focus:ring-teal-500"> <span>Remote Sensing</span></label>
                                <label class="flex items-center space-x-2"><input type="checkbox" value="GIS" class="program-filter rounded text-teal-600 focus:ring-teal-500"> <span>GIS</span></label>
                            </div>
                        </div>
                        <div>
                            <label for="state-filter" class="font-semibold text-gray-700 block mb-2">Filter by State</label>
                            <select id="state-filter" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                                <option value="all">All States</option>
                            </select>
                        </div>
                        <div>
                            <label class="font-semibold text-gray-700 block mb-2">Sort by</label>
                            <div id="sort-options" class="flex bg-gray-100 p-1 rounded-lg">
                                <button data-sort="rank" class="sort-button flex-1 py-2 px-4 text-sm font-medium rounded-md bg-white text-teal-700 shadow">Rank</button>
                                <button data-sort="name" class="sort-button flex-1 py-2 px-4 text-sm font-medium rounded-md text-gray-500">Name</button>
                            </div>
                        </div>
                        <div>
                            <label for="search-filter" class="font-semibold text-gray-700 block mb-2">Search by Name</label>
                            <input type="text" id="search-filter" placeholder="e.g., Purdue" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                        </div>
                    </div>
                </div>

                <div id="results-count" class="text-center text-gray-600 mb-6"></div>
                <div id="university-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="loader-container col-span-full flex justify-center py-10"><div class="loader"></div></div>
                </div>
            </div>
        </section>

        <section id="scholarships" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800">Scholarship & Funding Guide</h2>
                    <p class="text-md text-gray-600 max-w-2xl mx-auto mt-2">Finding funding is crucial. This section provides an overview of scholarships and assistantships available to international students. Many opportunities do not require U.S. citizenship.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                    <div>
                        <h3 class="text-2xl font-semibold mb-4">Major External Scholarships</h3>
                        <div id="external-scholarships-list" class="space-y-6"></div>
                    </div>
                    <div>
                        <h3 class="text-2xl font-semibold mb-4 text-center">Common University Funding Types</h3>
                        <div class="chart-container">
                            <canvas id="funding-chart"></canvas>
                        </div>
                        <p class="text-center text-sm text-gray-500 mt-2">This chart shows the prevalence of different types of institutional aid, like Teaching or Research Assistantships, across the listed universities.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="admissions" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-gray-800">Admissions Checklist</h2>
                    <p class="text-md text-gray-600 max-w-2xl mx-auto mt-2">Here is a general checklist of requirements for applying to a Master's program in the U.S. Always verify the specific requirements on each university's official website.</p>
                </div>
                <div id="admissions-checklist" class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8 grid grid-cols-1 md:grid-cols-2 gap-8"></div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>GeoMasters USA</p>
            <p class="text-sm text-gray-400 mt-2">An interactive guide based on publicly available data. All information should be verified on official university websites.</p>
        </div>
    </footer>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div id="modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto transform transition-all duration-300 scale-95 opacity-0">
        </div>
    </div>

<script>
const universityData = [
    {
        name: "Oregon State University",
        state: "OR",
        programs: [{ name: "Geomatics Engineering Program", type: "Geomatics" }],
        rank: { national: 144, public: 74, engineering: null },
        details: "Offers a Geomatics Engineering program within its College of Engineering. Research areas include geotechnical engineering, construction, and broader geomatics applications like assessing earthquake hazards and coastal erosion using lidar.",
        admission: "Check official website for specific GPA, GRE, and English proficiency requirements.",
        funding: "General graduate funding may be available.",
        link: "https://engineering.oregonstate.edu/"
    },
    {
        name: "Florida Atlantic University",
        state: "FL",
        programs: [{ name: "MS in Civil Engineering (Geomatics Focus)", type: "Geomatics" }],
        rank: { national: 189, public: 103, engineering: null },
        details: "The Department of Civil, Environmental and Geomatics Engineering offers graduate studies in Civil Engineering with a research focus in Geomatics, including technologies like digital photogrammetry, remote sensing, GPS, and drone-based mapping.",
        admission: "General graduate school requirements apply. Typically a 3.0 GPA is expected.",
        funding: "Limited information on specific international funding. General graduate assistantships may be available.",
        link: "https://www.fau.edu/engineering/cege/"
    },
    {
        name: "University of Maine",
        state: "ME",
        programs: [{ name: "MS in Spatial Information Science and Engineering", type: "Geomatics" }, { name: "MS in Spatial Information Science and Engineering", type: "GIS" }],
        rank: { national: 259, public: null, engineering: null },
        details: "This program emphasizes spatial computing, spatial cognition, spatio-temporal reasoning, and geosensor networks. It aims to advance knowledge about spatial information in next-generation information systems.",
        admission: "Check department for specific requirements.",
        funding: "General graduate funding may be available.",
        link: "https://umaine.edu/spatial/"
    },
    {
        name: "Virginia Tech",
        state: "VA",
        programs: [{ name: "MS in Civil Engineering (Geotechnical Focus)", type: "Geomatics" }],
        rank: { national: 47, public: 23, engineering: 31 },
        details: "Provides a Master of Science in Civil Engineering with a focus on Geotechnical Engineering, which includes relevant areas like geomechanics, earth structures, and earthquake engineering.",
        admission: "Highly competitive. Strong academic record required. GRE may be required.",
        funding: "Assistantships and fellowships are available on a competitive basis.",
        link: "https://cee.vt.edu/graduate/geotechnical-engineering.html"
    },
    {
        name: "Colorado School of Mines",
        state: "CO",
        programs: [{ name: "MS in GIS & GeoInformatics", type: "GIS" }, { name: "MS in Geophysical Engineering", type: "Geomatics" }],
        rank: { national: 76, public: 36, engineering: null },
        details: "Offers an MS in GIS & GeoInformatics with a focus on earth, energy, and environmental applications of GIS and remote sensing. An online, non-thesis option is available.",
        admission: "Bachelor's degree in a STEM field and strong quantitative skills expected.",
        funding: "Limited departmental scholarships. International students generally not eligible for federal financial aid and are advised to seek external funding.",
        link: "https://geology.mines.edu/graduate-academics/gis/"
    },
    {
        name: "University of Houston",
        state: "TX",
        programs: [{ name: "MS in Geosensing Systems Engineering & Sciences", type: "Geomatics" }, { name: "MS in Geosensing Systems Engineering & Sciences", type: "Remote Sensing" }],
        rank: { national: 144, public: null, engineering: null },
        details: "This unique, interdisciplinary program trains students in airborne mapping technologies like LiDAR for detailed topographical mapping, supporting research in diverse areas from ancient civilizations to flood mapping.",
        admission: "Requires a strong background in engineering, physics, or a related field.",
        funding: "Funding is available for qualified students in the GSES program. The university also offers specific scholarships for international students.",
        link: "https://www.cive.uh.edu/graduate/geosensing-systems"
    },
    {
        name: "Texas A&M University, Corpus Christi",
        state: "TX",
        programs: [{ name: "MS in Geospatial Systems Engineering", type: "Geomatics" }, { name: "MS in Geospatial Systems Engineering", type: "GIS" }],
        rank: { national: 392, public: null, engineering: null },
        details: "This program prepares graduates with advanced knowledge in the research, design, development, and use of technologies in geospatial surveying engineering. It builds upon an ABET-accredited undergraduate program.",
        admission: "Requires a 3.0 GPA. International students need TOEFL (79) or IELTS (6.5).",
        funding: "Offers several scholarships specifically for international students, such as the President's International Excellence Award.",
        link: "https://www.tamucc.edu/science-and-engineering/engineering/graduate-programs/geospatial-systems-engineering.php"
    },
    {
        name: "University of Florida",
        state: "FL",
        programs: [{ name: "Geomatics Program (MS)", type: "Geomatics" }],
        rank: { national: 30, public: 7, engineering: null },
        details: "The Geomatics program is recognized for its regional, national, and international impact, with a mission to provide high-quality education in the field. It has strong ties to the surveying profession and covers areas like digital imaging and mapping.",
        admission: "Highly competitive. Check department for specific requirements.",
        funding: "Competitive assistantships and fellowships are available.",
        link: "https://ffgs.ifas.ufl.edu/academics/geomatics/"
    },
    {
        name: "Purdue University",
        state: "IN",
        programs: [{ name: "MS in Civil Engineering (Geomatics Emphasis)", type: "Geomatics" }],
        rank: { national: 43, public: null, engineering: 4 },
        details: "Offers a Master's in Civil Engineering with a Geomatics emphasis, allowing study in property boundary determination, digital mapping, geodesy, GIS, GPS, photogrammetry, and remote sensing. Thesis and non-thesis options available.",
        admission: "Top-tier engineering school with high admission standards. GRE may be required.",
        funding: "Various scholarships and loans available, though international students face higher tuition rates.",
        link: "https://engineering.purdue.edu/CE/Academics/Groups/Geomatics"
    },
    {
        name: "Penn State University",
        state: "PA",
        programs: [{ name: "MGIS (Online)", type: "GIS" }, { name: "Grad Cert in Remote Sensing (Online)", type: "Remote Sensing" }],
        rank: { national: 63, public: 30, engineering: 20 },
        details: "Offers a highly respected 100% online Master of Geographic Information Systems (MGIS) and a Graduate Certificate in Remote Sensing and Earth Observation. The MGIS program allows specialization in Geospatial Intelligence or Geodesign.",
        admission: "Requires a 3.0 GPA. GRE not required for MGIS.",
        funding: "Eligible for U.S. federal financial aid (loans). The John A. Dutton e-Education Institute offers some scholarships.",
        link: "https://www.worldcampus.psu.edu/degrees-and-certificates/penn-state-online-geographic-information-systems-masters-degree"
    },
    {
        name: "University of Arizona",
        state: "AZ",
        programs: [{ name: "MS in GIST (Online)", type: "GIS" }, { name: "MS in GIST (Online)", type: "Remote Sensing" }],
        rank: { national: 115, public: 58, engineering: null },
        details: "Offers an online Master of Science in Geographic Information Systems Technology (MS-GIST) that integrates GIS science, geospatial technology, and management skills. Includes concentrations in Geospatial Data Science and Geospatial Analysis.",
        admission: "Requires a 3.0 GPA. No GRE required.",
        funding: "Merit tuition scholarships considered upon admission. Graduate Assistantships available. Use 'Scholarship Universe' to search for more.",
        link: "https://gis.arizona.edu/ms-gist"
    },
    {
        name: "Illinois State University",
        state: "IL",
        programs: [{ name: "MS Information Systems (GIS Sequence)", type: "GIS" }],
        rank: { national: 220, public: null, engineering: null },
        details: "A cross-disciplinary program teaching theory and practical experience in using GIS for statistical analysis and spatial interpretation. Collaboration between Information Technology and Geography/Geology.",
        admission: "Requires 3.0 GPA in last 60 hours. GRE (300+) required, but waivers are possible for applicants with a Master's degree or strong professional experience.",
        funding: "Graduate Assistantships (TA/RA) with tuition waivers are available. In-state tuition offered to residents of contiguous states.",
        link: "https://illinoisstate.edu/academics/geographic-information-systems/"
    },
    {
        name: "University of Maryland, College Park",
        state: "MD",
        programs: [{ name: "MPS in GIS", type: "GIS" }],
        rank: { national: 44, public: 17, engineering: null },
        details: "The Master of Professional Studies (MPS) in GIS emphasizes practical skills in real-world scenarios, covering spatial analysis, programming, databases, remote sensing, web/mobile GIS, big data analytics, and machine learning.",
        admission: "Requires a 3.0 GPA. Check program for GRE requirements.",
        funding: "General graduate funding may be available through the graduate school.",
        link: "https://geog.umd.edu/graduate/mps-gis"
    },
    {
        name: "University of Minnesota, Twin Cities",
        state: "MN",
        programs: [{ name: "Master of GIS (MGIS)", type: "GIS" }],
        rank: { national: 54, public: 23, engineering: null },
        details: "The MGIS program offers graduate-level work in GIS theory, applications, and technology. Provides flexible study options (part-time or full-time) and opportunities to earn minors in related fields. Considered a cost-effective option.",
        admission: "Requires 3.0 GPA. GRE not required.",
        funding: "Research/Teaching Assistantships often include tuition payment. Specific scholarships for international students are available.",
        link: "https://mgis.umn.edu/"
    },
    {
        name: "University of Utah",
        state: "UT",
        programs: [{ name: "MS in GIS (MSGIS)", type: "GIS" }],
        rank: { national: null, public: null, engineering: null },
        details: "An interdisciplinary, professional degree allowing students to specialize in GIScience. Focuses on gathering, analyzing, and communicating spatially explicit data for demanding job markets in tech, government, and consulting.",
        admission: "Requires 3.0 GPA. GRE required, but waivers possible for applicants with a Master's degree or strong professional experience.",
        funding: "MSGIS students are not eligible for departmental funding. Advises seeking external funding. WICHE WRGP offers in-state tuition for residents of specific Western states.",
        link: "https://geog.utah.edu/graduate/msgis/index.php"
    },
    {
        name: "Texas A&M University, College Station",
        state: "TX",
        programs: [{ name: "Master of Geoscience (GIST Track)", type: "GIS" }, { name: "Master of Geoscience (GIST Track)", type: "Remote Sensing" }],
        rank: { national: 51, public: null, engineering: 16 },
        details: "A 36-credit, non-thesis online program providing skills in Geographic Information Science and Technology. Includes a required course in Remote Sensing for Geographical Analysis.",
        admission: "Strong academic record required. Check department for specific requirements.",
        funding: "Numerous scholarships specifically for international students (e.g., International Education Fee Scholarship, Good Neighbor Program). Requires a 3.0+ GPA.",
        link: "https://geosciences.tamu.edu/academics/graduate-studies/distance-learning/mgsc-gist.html"
    },
    {
        name: "Ohio State University",
        state: "OH",
        programs: [{ name: "Master of GIS", type: "GIS" }],
        rank: { national: 41, public: 15, engineering: 20 },
        details: "Designated as a Center for Academic Excellence in Geospatial Sciences by the NGA. Offers strong programs in GIS and related technologies within the Department of Geography.",
        admission: "Requires a 3.0 GPA. For international students, TOEFL 79 or IELTS 7.0 is required.",
        funding: "Competitive assistantships and fellowships available, often including tuition waivers.",
        link: "https://geography.osu.edu/graduate/mgis"
    }
];

const externalScholarships = [
    {
        name: "USGIF Scholarship Program",
        eligibility: "U.S. Citizenship is NOT required for general fund.",
        details: "Supports students passionate about geospatial intelligence. Awards range from $5,000 to $15,000. Requires GPA > 2.5, recommendations, and essays.",
        link: "https://usgif.org/usgif-scholarship-program/"
    },
    {
        name: "Fulbright Foreign Student Program",
        eligibility: "For non-U.S. citizens. Apply through your home country's Fulbright Commission.",
        details: "Prestigious, highly competitive program providing significant financial support and enhancing your academic profile.",
        link: "https://foreign.fulbrightonline.org/about/foreign-fulbright"
    },
    {
        name: "Rotary Peace Fellowships",
        eligibility: "For leaders with work experience in peace and development.",
        details: "Fully funded fellowships for Master's degrees. Applications open well in advance (e.g., Feb 2026 for 2027-28).",
        link: "https://www.rotary.org/en/our-programs/peace-fellowships"
    }
];

const admissionsChecklistData = [
    {
        category: "Academic Requirements",
        icon: "ðŸŽ“",
        items: [
            "<strong>4-Year Bachelor's Degree:</strong> From an accredited institution.",
            "<strong>Minimum GPA:</strong> Typically 3.0 on a 4.0 scale for undergraduate work.",
            "<strong>Transcripts:</strong> Unofficial for application, official upon admission."
        ]
    },
    {
        category: "Standardized Tests",
        icon: "ðŸ“Š",
        items: [
            "<strong>GRE:</strong> Often required (target 300+). Some programs offer waivers for experienced professionals or those with a Master's degree.",
            "<strong>English Proficiency (for International Students):</strong> TOEFL (typically 80-100 iBT), IELTS (typically 6.5-7.5), or Duolingo (typically 105+)."
        ]
    },
    {
        category: "Application Materials",
        icon: "ðŸ“„",
        items: [
            "<strong>Statement of Purpose:</strong> A compelling essay about your goals and interests.",
            "<strong>Letters of Recommendation:</strong> Usually 2-3 from academic or professional mentors.",
            "<strong>CV / Resume:</strong> Highlighting relevant experience and skills."
        ]
    },
    {
        category: "Key Advice",
        icon: "ðŸ’¡",
        items: [
            "<strong>Apply Early:</strong> Scholarship and admission deadlines can be as early as January for Fall intake.",
            "<strong>Contact Faculty:</strong> Reach out to professors whose research interests you.",
            "<strong>Verify Everything:</strong> Always check the official university and department websites for the most current information."
        ]
    }
];

document.addEventListener('DOMContentLoaded', () => {
    const universityGrid = document.getElementById('university-grid');
    const stateFilter = document.getElementById('state-filter');
    const programFilters = document.querySelectorAll('.program-filter');
    const searchFilter = document.getElementById('search-filter');
    const sortButtons = document.querySelectorAll('.sort-button');
    const resultsCount = document.getElementById('results-count');
    const modal = document.getElementById('modal');
    const modalContent = document.getElementById('modal-content');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    let currentSort = 'rank';
    let activeFilters = {
        programs: [],
        state: 'all',
        search: ''
    };

    function populateStates() {
        const states = [...new Set(universityData.map(u => u.state))].sort();
        states.forEach(state => {
            const option = document.createElement('option');
            option.value = state;
            option.textContent = state;
            stateFilter.appendChild(option);
        });
    }

    function renderUniversities() {
        universityGrid.innerHTML = '<div class="loader-container col-span-full flex justify-center py-10"><div class="loader"></div></div>';
        
        setTimeout(() => {
            let filteredData = universityData;

            if (activeFilters.programs.length > 0) {
                filteredData = filteredData.filter(uni => 
                    uni.programs.some(prog => activeFilters.programs.includes(prog.type))
                );
            }

            if (activeFilters.state !== 'all') {
                filteredData = filteredData.filter(uni => uni.state === activeFilters.state);
            }

            if (activeFilters.search) {
                filteredData = filteredData.filter(uni => uni.name.toLowerCase().includes(activeFilters.search.toLowerCase()));
            }

            filteredData.sort((a, b) => {
                if (currentSort === 'name') {
                    return a.name.localeCompare(b.name);
                } else {
                    const rankA = a.rank.national || 999;
                    const rankB = b.rank.national || 999;
                    return rankA - rankB;
                }
            });

            universityGrid.innerHTML = '';
            resultsCount.textContent = `Showing ${filteredData.length} of ${universityData.length} universities.`;

            if (filteredData.length === 0) {
                universityGrid.innerHTML = `<p class="col-span-full text-center text-gray-500">No universities match your criteria. Try adjusting your filters.</p>`;
                return;
            }

            filteredData.forEach(uni => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-md overflow-hidden transform hover:-translate-y-1 transition-all duration-300 cursor-pointer';
                card.innerHTML = `
                    <div class="p-6">
                        <div class="flex justify-between items-start">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${uni.name}</h3>
                            <span class="text-sm font-semibold text-teal-700 bg-teal-100 py-1 px-2 rounded-full">${uni.state}</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-4 h-10">
                            ${uni.programs.map(p => p.name).join('<br>')}
                        </div>
                        <div class="flex justify-start space-x-4 text-xs text-gray-500">
                            ${uni.rank.national ? `<span title="National Rank">#${uni.rank.national} Nat'l</span>` : ''}
                            ${uni.rank.public ? `<span title="Public Rank">#${uni.rank.public} Public</span>` : ''}
                            ${uni.rank.engineering ? `<span title="Engineering Rank">#${uni.rank.engineering} Eng.</span>` : ''}
                        </div>
                    </div>
                    <div class="bg-gray-50 px-6 py-3 text-right">
                        <span class="text-sm font-semibold text-teal-600">View Details &rarr;</span>
                    </div>
                `;
                card.addEventListener('click', () => showModal(uni));
                universityGrid.appendChild(card);
            });
        }, 300);
    }

    function showModal(uni) {
        modalContent.innerHTML = `
            <div class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">${uni.name}</h2>
                        <p class="text-md text-gray-500">${uni.state}</p>
                    </div>
                    <button id="close-modal" class="text-gray-400 hover:text-gray-600">&times;</button>
                </div>

                <div class="space-y-6">
                    <div>
                        <h4 class="font-semibold text-lg text-gray-700 mb-2">Programs Offered</h4>
                        <ul class="list-disc list-inside text-gray-600 space-y-1">
                            ${uni.programs.map(p => `<li><strong>${p.name}</strong> (${p.type})</li>`).join('')}
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-gray-700 mb-2">Program Details</h4>
                        <p class="text-gray-600">${uni.details}</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-lg text-gray-700 mb-2">Admission Insights</h4>
                        <p class="text-gray-600">${uni.admission}</p>
                    </div>
                     <div>
                        <h4 class="font-semibold text-lg text-gray-700 mb-2">Funding & Scholarships</h4>
                        <p class="text-gray-600">${uni.funding}</p>
                    </div>
                </div>
                <div class="mt-8 text-right">
                    <a href="${uni.link}" target="_blank" rel="noopener noreferrer" class="bg-teal-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-teal-700 transition-colors">Visit Program Website</a>
                </div>
            </div>
        `;
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        setTimeout(() => {
            modalContent.classList.remove('scale-95', 'opacity-0');
        }, 10);

        document.getElementById('close-modal').addEventListener('click', hideModal);
    }

    function hideModal() {
        modalContent.classList.add('scale-95', 'opacity-0');
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }, 300);
    }

    function renderExternalScholarships() {
        const list = document.getElementById('external-scholarships-list');
        list.innerHTML = externalScholarships.map(s => `
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h4 class="font-bold text-lg text-teal-800">${s.name}</h4>
                <p class="text-sm font-semibold text-red-600 my-1">${s.eligibility}</p>
                <p class="text-sm text-gray-600 mb-2">${s.details}</p>
                <a href="${s.link}" target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-teal-600 hover:underline">Learn More &rarr;</a>
            </div>
        `).join('');
    }

    function renderAdmissionsChecklist() {
        const container = document.getElementById('admissions-checklist');
        container.innerHTML = admissionsChecklistData.map(cat => `
            <div>
                <h3 class="text-xl font-semibold text-gray-700 mb-3">${cat.icon} ${cat.category}</h3>
                <ul class="space-y-2">
                    ${cat.items.map(item => `<li class="flex items-start"><span class="text-teal-500 mr-3 mt-1">&#10003;</span><span class="text-gray-600">${item}</span></li>`).join('')}
                </ul>
            </div>
        `).join('');
    }

    function createFundingChart() {
        const fundingTypes = {};
        universityData.forEach(uni => {
            if (uni.funding.toLowerCase().includes('assistantship')) {
                fundingTypes['Assistantships (TA/RA)'] = (fundingTypes['Assistantships (TA/RA)'] || 0) + 1;
            }
            if (uni.funding.toLowerCase().includes('scholarship')) {
                fundingTypes['Merit Scholarships'] = (fundingTypes['Merit Scholarships'] || 0) + 1;
            }
            if (uni.funding.toLowerCase().includes('fellowship')) {
                fundingTypes['Fellowships'] = (fundingTypes['Fellowships'] || 0) + 1;
            }
        });

        const ctx = document.getElementById('funding-chart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(fundingTypes),
                datasets: [{
                    label: 'Number of Universities',
                    data: Object.values(fundingTypes),
                    backgroundColor: ['#0d9488', '#0f766e', '#115e59', '#134e4a'],
                    borderColor: '#ffffff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += context.parsed + ' universities';
                                }
                                return label;
                            }
                        }
                    }
                }
            }
        });
    }
    
    function handleSort(e) {
        const target = e.target.closest('.sort-button');
        if (!target) return;

        currentSort = target.dataset.sort;
        sortButtons.forEach(btn => {
            btn.classList.remove('bg-white', 'text-teal-700', 'shadow');
            btn.classList.add('text-gray-500');
        });
        target.classList.add('bg-white', 'text-teal-700', 'shadow');
        target.classList.remove('text-gray-500');
        renderUniversities();
    }

    function handleFilterChange() {
        activeFilters.programs = [...document.querySelectorAll('.program-filter:checked')].map(el => el.value);
        activeFilters.state = stateFilter.value;
        activeFilters.search = searchFilter.value;
        renderUniversities();
    }

    programFilters.forEach(el => el.addEventListener('change', handleFilterChange));
    stateFilter.addEventListener('change', handleFilterChange);
    searchFilter.addEventListener('input', handleFilterChange);
    document.getElementById('sort-options').addEventListener('click', handleSort);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) hideModal();
    });
    
    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });

    document.querySelectorAll('#mobile-menu a').forEach(link => {
        link.addEventListener('click', () => mobileMenu.classList.add('hidden'));
    });

    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('main section');
    
    window.addEventListener('scroll', () => {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            if (pageYOffset >= sectionTop - 60) {
                current = section.getAttribute('id');
            }
        });

        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href').includes(current)) {
                link.classList.add('active');
            }
        });
    });

    populateStates();
    renderUniversities();
    renderExternalScholarships();
    renderAdmissionsChecklist();
    createFundingChart();
});
</script>

</body>
</html>
